---
title: "Test"
---

import { useState, useEffect, useMemo } from "react";

export const MinTxCalculator = () => {
  // === Data ===
  const currencyToSourceRails = {
    mxn: ["spei"],
    usd: ["ach", "wire"],
    euro: ["sepa"],
    usdc: ["ethereum", "polygon", "base", "arbitrum", "avalanche", "optimism", "solana", "stellar"],
    usdt: ["ethereum", "tron"],
    dai: ["ethereum"],
    usdp: ["ethereum"],
    pyusd: ["ethereum", "solana"],
    eurc: ["solana"],
    btc: ["bitcoin"],
    eth: ["ethereum"],
    usdb: ["bridge_wallet"],
  };

  const currencyToDestRails = {
    mxn: ["spei"],
    usd: ["ach_push", "ach_same_day", "wire"],
    euro: ["sepa"],
    usdc: ["ethereum", "polygon", "base", "arbitrum", "avalanche", "optimism", "solana", "stellar"],
    usdt: ["ethereum", "tron"],
    dai: ["ethereum"],
    usdp: ["ethereum"],
    pyusd: ["ethereum", "solana"],
    eurc: ["solana"],
    btc: ["bitcoin"],
    eth: ["ethereum"],
    usdb: ["bridge_wallet"],
  };

  const allCurrencies = useMemo(() => Object.keys(currencyToSourceRails), []);
  const allRails = useMemo(() => {
    const s = Object.values(currencyToSourceRails).flat();
    const d = Object.values(currencyToDestRails).flat();
    return Array.from(new Set([...s, ...d]));
  }, []);

  // === State ===
  const [sourceCurrency, setSourceCurrency] = useState("");
  const [sourceRail, setSourceRail] = useState("");
  const [destCurrency, setDestCurrency] = useState("");
  const [destRail, setDestRail] = useState("");
  const [result, setResult] = useState("Minimum required: ‚Äî");

  const sortAsc = (arr) => [...arr].sort((a, b) => a.localeCompare(b));

  // === Derived option lists (respecting selections) ===
  const validSourceRails = useMemo(() => {
    if (!sourceCurrency) return sortAsc(allRails);
    return sortAsc(currencyToSourceRails[sourceCurrency] ?? []);
  }, [sourceCurrency, allRails]);

  const validSourceCurrencies = useMemo(() => {
    if (!sourceRail) return sortAsc(allCurrencies);
    return sortAsc(
      allCurrencies.filter((cur) => (currencyToSourceRails[cur] ?? []).includes(sourceRail))
    );
  }, [sourceRail, allCurrencies]);

  const validDestRails = useMemo(() => {
    if (!destCurrency) return sortAsc(allRails);
    return sortAsc(currencyToDestRails[destCurrency] ?? []);
  }, [destCurrency, allRails]);

  const validDestCurrencies = useMemo(() => {
    if (!destRail) return sortAsc(allCurrencies);
    return sortAsc(
      allCurrencies.filter((cur) => (currencyToDestRails[cur] ?? []).includes(destRail))
    );
  }, [destRail, allCurrencies]);

  // === Auto-fix dependent fields when options change ===
  useEffect(() => {
    if (sourceRail && !validSourceRails.includes(sourceRail)) setSourceRail("");
    if (!sourceRail && validSourceRails.length === 1) setSourceRail(validSourceRails[0]);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [validSourceRails.join("|")]);

  useEffect(() => {
    if (sourceCurrency && !validSourceCurrencies.includes(sourceCurrency)) setSourceCurrency("");
    if (!sourceCurrency && validSourceCurrencies.length === 1) setSourceCurrency(validSourceCurrencies[0]);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [validSourceCurrencies.join("|")]);

  useEffect(() => {
    if (destRail && !validDestRails.includes(destRail)) setDestRail("");
    if (!destRail && validDestRails.length === 1) setDestRail(validDestRails[0]);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [validDestRails.join("|")]);

  useEffect(() => {
    if (destCurrency && !validDestCurrencies.includes(destCurrency)) setDestCurrency("");
    if (!destCurrency && validDestCurrencies.length === 1) setDestCurrency(validDestCurrencies[0]);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [validDestCurrencies.join("|")]);

  const filled = sourceCurrency && sourceRail && destCurrency && destRail;

  // === Calculation (ported 1:1) ===
  const onCalculate = () => {
    const src = (sourceCurrency || "").toLowerCase();
    const dst = (destCurrency || "").toLowerCase();
    const rail = (sourceRail || "").toLowerCase();
    const dstRailLower = (destRail || "").toLowerCase();

    const fiats = ["usd", "euro", "mxn"];
    if (fiats.includes(src) && fiats.includes(dst)) {
      setResult(
        `üõ†Ô∏è Fiat-to-fiat transfers are not available yet, but coming soon!`
      );
      return;
    }

    let reasons = [];
    let base = 1.0;
    const stable = ["usdc", "usdt", "usdp", "dai", "pyusd", "eurc"];
    const nonStable = ["eth", "btc"];
    const exchangeFee = ["dai", "usdt"];
    const requiresGasForWithdrawal = ["btc", "dai", "eth", "usdt"];
    const expensiveGas = ["bitcoin", "ethereum"];

    base = !fiats.includes(src) ? (stable.includes(src) ? 1.0 : 2.0) : 1.0;

    let mins = [base];

    if (
      exchangeFee.includes(src) ||
      exchangeFee.includes(dst) ||
      nonStable.includes(src) ||
      nonStable.includes(dst)
    ) {
      mins.push(2);
      reasons.push("Exchange or crypto fee");
    }

    if (requiresGasForWithdrawal.includes(dst) && expensiveGas.includes(dstRailLower)) {
      mins.push(20);
      reasons.push("Gas cost on destination rail");
    }

    if (rail === "tron" || dstRailLower === "tron") {
      mins.push(5);
      reasons.push("Tron adjustment");
    }

    if (src === "mxn") {
      mins.push(50);
      reasons.push("MXN source minimum");
    }
    if (dst === "mxn") {
      mins.push(2);
      reasons.push("MXN destination minimum");
    }

    const finalMin = Math.max(...mins);
    const displayCurrency = src.toUpperCase();

    setResult(
      `Minimum required: ${finalMin.toFixed(2)} ${displayCurrency}\nReason: ${reasons.join(", ") || "base minimum applied"}`
    );
  };

  const onReset = () => {
    setSourceCurrency("");
    setSourceRail("");
    setDestCurrency("");
    setDestRail("");
    setResult("Minimum required: ‚Äî");
  };

  // === UI ===
  const Select = ({ id, label, value, onChange, options }) => (
    <div className="flex-1">
      <label htmlFor={id} className="block text-sm font-medium mb-1">
        {label}
      </label>
      <select
        id={id}
        value={value}
        onChange={(e) => onChange(e.target.value)}
        className="w-full h-10 rounded-xl border border-zinc-950/20 dark:border-white/20 bg-transparent px-3"
      >
        <option value="">{`-- Select --`}</option>
        {options.map((opt) => (
          <option key={opt} value={opt}>
            {opt.toUpperCase()}
          </option>
        ))}
      </select>
    </div>
  );

  return (
    <div className="max-w-2xl mx-auto p-4">
      <h2 className="text-xl font-semibold mb-4">Minimum Transaction Calculator</h2>

      <fieldset className="border border-zinc-950/20 dark:border-white/20 rounded-xl p-4 mb-4">
        <legend className="px-2 text-sm font-semibold">Source</legend>
        <div className="flex gap-3">
          <Select
            id="sourceCurrency"
            label="Source Currency"
            value={sourceCurrency}
            onChange={setSourceCurrency}
            options={validSourceCurrencies}
          />
          <Select
            id="sourceRail"
            label="Source Payment Rail"
            value={sourceRail}
            onChange={setSourceRail}
            options={validSourceRails}
          />
        </div>
      </fieldset>

      <fieldset className="border border-zinc-950/20 dark:border-white/20 rounded-xl p-4 mb-4">
        <legend className="px-2 text-sm font-semibold">Destination</legend>
        <div className="flex gap-3">
          <Select
            id="destCurrency"
            label="Destination Currency"
            value={destCurrency}
            onChange={setDestCurrency}
            options={validDestCurrencies}
          />
          <Select
            id="destRail"
            label="Destination Payment Rail"
            value={destRail}
            onChange={setDestRail}
            options={validDestRails}
          />
        </div>
      </fieldset>

      <div className="flex gap-3">
        <button
          disabled={!filled}
          onClick={onCalculate}
          className="h-10 px-4 rounded-xl border border-zinc-950/20 dark:border-white/20 disabled:opacity-60"
        >
          Calculate Minimum
        </button>
        <button
          onClick={onReset}
          className="h-10 px-4 rounded-xl border border-zinc-950/20 dark:border-white/20"
        >
          Reset
        </button>
      </div>

      <div className="mt-4 font-medium whitespace-pre-line">
        {result.startsWith("üõ†Ô∏è") ? (
          <span className="text-amber-500">{result}</span>
        ) : (
          <span>{result}</span>
        )}
      </div>
    </div>
  );
};

## Minimums
<MinTxCalculator />