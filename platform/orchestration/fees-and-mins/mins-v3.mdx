---
title: "Test"
---
export const MinTxCalculator = () => {
  // --- Data (same as your app) ---
  const currencyToSourceRails = {
    mxn: ["spei"],
    usd: ["ach", "wire"],
    euro: ["sepa"],
    usdc: ["ethereum", "polygon", "base", "arbitrum", "avalanche", "optimism", "solana", "stellar"],
    usdt: ["ethereum", "tron"],
    dai: ["ethereum"],
    usdp: ["ethereum"],
    pyusd: ["ethereum", "solana"],
    eurc: ["solana"],
    btc: ["bitcoin"],
    eth: ["ethereum"],
    usdb: ["bridge_wallet"],
  };

  const currencyToDestRails = {
    mxn: ["spei"],
    usd: ["ach_push", "ach_same_day", "wire"],
    euro: ["sepa"],
    usdc: ["ethereum", "polygon", "base", "arbitrum", "avalanche", "optimism", "solana", "stellar"],
    usdt: ["ethereum", "tron"],
    dai: ["ethereum"],
    usdp: ["ethereum"],
    pyusd: ["ethereum", "solana"],
    eurc: ["solana"],
    btc: ["bitcoin"],
    eth: ["ethereum"],
    usdb: ["bridge_wallet"],
  };

  const allCurrencies = Object.keys(currencyToSourceRails);
  const allRails = Array.from(
    new Set(
      Object.values(currencyToSourceRails).flat().concat(Object.values(currencyToDestRails).flat())
    )
  );

  // --- State ---
  const [sourceCurrency, setSourceCurrency] = useState("");
  const [sourceRail, setSourceRail] = useState("");
  const [destCurrency, setDestCurrency] = useState("");
  const [destRail, setDestRail] = useState("");
  const [result, setResult] = useState("Minimum required: ‚Äî");

  const sortAsc = (arr) => [...arr].sort((a, b) => a.localeCompare(b));

  // --- Helpers for valid options based on the counterpart selection ---
  const validSourceRailsFor = (cur) => (cur ? currencyToSourceRails[cur] || [] : allRails);
  const validSourceCurrenciesFor = (rail) =>
    rail ? allCurrencies.filter((c) => (currencyToSourceRails[c] || []).includes(rail)) : allCurrencies;

  const validDestRailsFor = (cur) => (cur ? currencyToDestRails[cur] || [] : allRails);
  const validDestCurrenciesFor = (rail) =>
    rail ? allCurrencies.filter((c) => (currencyToDestRails[c] || []).includes(rail)) : allCurrencies;

  // --- Change handlers that also reconcile the dependent field ---
  const onSourceCurrency = (cur) => {
    setSourceCurrency(cur);
    const rails = validSourceRailsFor(cur);
    setSourceRail((prev) => (rails.length === 1 ? rails[0] : rails.includes(prev) ? prev : ""));
  };
  const onSourceRail = (rail) => {
    setSourceRail(rail);
    const curs = validSourceCurrenciesFor(rail);
    setSourceCurrency((prev) => (curs.length === 1 ? curs[0] : curs.includes(prev) ? prev : ""));
  };

  const onDestCurrency = (cur) => {
    setDestCurrency(cur);
    const rails = validDestRailsFor(cur);
    setDestRail((prev) => (rails.length === 1 ? rails[0] : rails.includes(prev) ? prev : ""));
  };
  const onDestRail = (rail) => {
    setDestRail(rail);
    const curs = validDestCurrenciesFor(rail);
    setDestCurrency((prev) => (curs.length === 1 ? curs[0] : curs.includes(prev) ? prev : ""));
  };

  // --- Derived option arrays (sorted for display) ---
  const sourceRails = sortAsc(validSourceRailsFor(sourceCurrency));
  const sourceCurrencies = sortAsc(validSourceCurrenciesFor(sourceRail));
  const destRails = sortAsc(validDestRailsFor(destCurrency));
  const destCurrencies = sortAsc(validDestCurrenciesFor(destRail));

  const filled = sourceCurrency && sourceRail && destCurrency && destRail;

  // --- Calculation (1:1 port) ---
  const onCalculate = () => {
    const src = (sourceCurrency || "").toLowerCase();
    const dst = (destCurrency || "").toLowerCase();
    const rail = (sourceRail || "").toLowerCase();
    const dstRailLower = (destRail || "").toLowerCase();

    const fiats = ["usd", "euro", "mxn"];
    if (fiats.includes(src) && fiats.includes(dst)) {
      setResult("üõ†Ô∏è Fiat-to-fiat transfers are not available yet, but coming soon!");
      return;
    }

    let reasons = [];
    let base = 1.0;
    const stable = ["usdc", "usdt", "usdp", "dai", "pyusd", "eurc"];
    const nonStable = ["eth", "btc"];
    const exchangeFee = ["dai", "usdt"];
    const requiresGasForWithdrawal = ["btc", "dai", "eth", "usdt"];
    const expensiveGas = ["bitcoin", "ethereum"];

    base = !fiats.includes(src) ? (stable.includes(src) ? 1.0 : 2.0) : 1.0;

    let mins = [base];

    if (
      exchangeFee.includes(src) ||
      exchangeFee.includes(dst) ||
      nonStable.includes(src) ||
      nonStable.includes(dst)
    ) {
      mins.push(2);
      reasons.push("Exchange or crypto fee");
    }

    if (requiresGasForWithdrawal.includes(dst) && expensiveGas.includes(dstRailLower)) {
      mins.push(20);
      reasons.push("Gas cost on destination rail");
    }

    if (rail === "tron" || dstRailLower === "tron") {
      mins.push(5);
      reasons.push("Tron adjustment");
    }

    if (src === "mxn") {
      mins.push(50);
      reasons.push("MXN source minimum");
    }
    if (dst === "mxn") {
      mins.push(2);
      reasons.push("MXN destination minimum");
    }

    const finalMin = Math.max(...mins);
    const displayCurrency = src.toUpperCase();

    setResult(
      `Minimum required: ${finalMin.toFixed(2)} ${displayCurrency}\nReason: ${reasons.join(", ") || "base minimum applied"}`
    );
  };

  const onReset = () => {
    setSourceCurrency("");
    setSourceRail("");
    setDestCurrency("");
    setDestRail("");
    setResult("Minimum required: ‚Äî");
  };

  // --- Small Select helper ---
  const Select = ({ id, label, value, onChange, options }) => (
    <div className="flex-1">
      <label htmlFor={id} className="block text-sm font-medium mb-1">
        {label}
      </label>
      <select
        id={id}
        value={value}
        onChange={(e) => onChange(e.target.value)}
        className="w-full h-10 rounded-xl border border-zinc-950/20 dark:border-white/20 bg-transparent px-3"
      >
        <option value="">{`-- Select --`}</option>
        {options.map((opt) => (
          <option key={opt} value={opt}>
            {opt.toUpperCase()}
          </option>
        ))}
      </select>
    </div>
  );

  return (
    <div className="max-w-2xl mx-auto p-4">
      <h2 className="text-xl font-semibold mb-4">Minimum Transaction Calculator</h2>

      <fieldset className="border border-zinc-950/20 dark:border-white/20 rounded-xl p-4 mb-4">
        <legend className="px-2 text-sm font-semibold">Source</legend>
        <div className="flex gap-3">
          <Select
            id="sourceCurrency"
            label="Source Currency"
            value={sourceCurrency}
            onChange={onSourceCurrency}
            options={sourceCurrencies}
          />
          <Select
            id="sourceRail"
            label="Source Payment Rail"
            value={sourceRail}
            onChange={onSourceRail}
            options={sourceRails}
          />
        </div>
      </fieldset>

      <fieldset className="border border-zinc-950/20 dark:border-white/20 rounded-xl p-4 mb-4">
        <legend className="px-2 text-sm font-semibold">Destination</legend>
        <div className="flex gap-3">
          <Select
            id="destCurrency"
            label="Destination Currency"
            value={destCurrency}
            onChange={onDestCurrency}
            options={destCurrencies}
          />
          <Select
            id="destRail"
            label="Destination Payment Rail"
            value={destRail}
            onChange={onDestRail}
            options={destRails}
          />
        </div>
      </fieldset>

      <div className="flex gap-3">
        <button
          disabled={!filled}
          onClick={onCalculate}
          className="h-10 px-4 rounded-xl border border-zinc-950/20 dark:border-white/20 disabled:opacity-60"
        >
          Calculate Minimum
        </button>
        <button
          onClick={onReset}
          className="h-10 px-4 rounded-xl border border-zinc-950/20 dark:border-white/20"
        >
          Reset
        </button>
      </div>

      <div className="mt-4 font-medium whitespace-pre-line">
        {result.startsWith("üõ†Ô∏è") ? (
          <span className="text-amber-500">{result}</span>
        ) : (
          <span>{result}</span>
        )}
      </div>
    </div>
  );
};

## Minimums
<MinTxCalculator />
